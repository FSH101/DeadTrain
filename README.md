# Призрачная электричка

Мини-интерактив о путешествии внутри призрачной электрички. Проект был пересобран так, чтобы история описывалась декларативно и дополнялась без правки движка.

## Как устроен проект

```
├── css/
│   └── train.css          # Оформление экрана истории
├── js/
│   ├── data/
│   │   └── story.js       # Описание всех вагонов и узлов сюжета
│   ├── engine/
│   │   └── storyEngine.js # Логика переходов между узлами
│   ├── ui/
│   │   └── domRenderer.js # Отрисовка узла истории в DOM
│   └── main.js            # Точка входа, связывает движок и интерфейс
├── index.html             # Титульный экран
└── train.html             # Экран путешествия по истории
```

* **StoryEngine** управляет текущим положением игрока: отслеживает вагон и узел, обрабатывает выборы, автоматически проходит узлы-переходы.
* **DomRenderer** отвечает только за отображение: он знает, как выглядят текстовые узлы, вопросы и концовки.
* **story.js** содержит сам сюжет, разбитый на вагоны и узлы, и импортируется как обычный модуль.

Благодаря такой схеме новые развилки добавляются правкой данных, а не кода движка.

## Структура данных истории

Файл `js/data/story.js` экспортирует объект `story` со следующей структурой:

```js
export const story = {
  start: { wagonId: 'awakening', nodeId: 'wakeUp' },
  wagons: {
    awakening: {
      id: 'awakening',
      title: 'Вагон 1: Пробуждение',
      nodes: {
        wakeUp: { type: 'text', content: '...', next: 'nextNode' },
        choiceExample: {
          type: 'choice',
          prompt: 'Вопрос?',
          options: [
            { text: 'Вариант A', next: 'otherNode' },
            { text: 'Вариант B', next: { wagonId: 'another', nodeId: 'entry' } }
          ]
        },
        transitionNode: {
          type: 'transition',
          target: { wagonId: 'another', nodeId: 'entry' }
        },
        endingNode: {
          type: 'ending',
          content: 'Финальный текст',
          actions: [
            { text: 'Начать заново', target: 'start' },
            { text: 'Закрыть глаза', target: null }
          ]
        }
      }
    }
  }
};
```

### Типы узлов

| Тип          | Описание | Обязательные поля | Дополнительные поля |
|--------------|----------|-------------------|---------------------|
| `text`       | Параграф повествования. Кнопка «Далее» ведёт к `next`. | `content`, `next` | `note`, `nextLabel` |
| `choice`     | Выбор игрока. Каждая опция указывает следующий узел. | `prompt`, `options` | `description` (текст под вопросом), `options[].description` |
| `transition` | Автоматический переход в другой узел или вагон. | `target` | — |
| `ending`     | Завершение ветки. Кнопки описываются в `actions`. | `content` | `note`, `actions` (по умолчанию — кнопка «Начать заново») |

В `options[].next` и `actions[].target` можно передать:

- строку с `nodeId` — переход в узел текущего вагона;
- объект `{ wagonId, nodeId }` — переход в конкретный узел другого вагона;
- строку `'start'` — возврат к стартовому узлу из `story.start`;
- `null` или `undefined` — завершение истории с экраном «Путь завершён».

## Как добавить новую ветку

1. Выберите вагон, в который хотите добавить развилку, или создайте новый объект вагона в `wagons`.
2. Добавьте новый узел в `nodes` и при необходимости опишите выборы, указывая `next`/`target` на существующие или новые узлы.
3. Если нужен новый вагон, впишите его `id` в `wagons`, создайте стартовый узел и добавьте переход из другой ветки с `target: { wagonId: 'новыйId', nodeId: 'entry' }`.
4. Сохраните файл — интерфейс автоматически подхватит изменения, потому что движок опирается на структуру данных.

## Запуск

Страницы статичны, поэтому достаточно открыть `index.html` в браузере или обслуживать проект любым простым веб-сервером (например, `npx serve .`).
