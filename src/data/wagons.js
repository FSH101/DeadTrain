const createFloorWithCar = (spriteId) => [
  {
    tileId: 'scene-train-car',
    position: { x: 2, y: 1.5, z: -20 },
    drawBase: false,
    sprite: { id: spriteId },
  },
];

const baseNavmesh = [
  { x: 0, y: 0 },
  { x: 1, y: 0 },
  { x: 2, y: 0 },
  { x: 3, y: 0 },
  { x: 0, y: 1 },
  { x: 1, y: 1 },
  { x: 2, y: 1 },
  { x: 3, y: 1 },
  { x: 4, y: 1 },
  { x: 0, y: 2 },
  { x: 1, y: 2 },
  { x: 2, y: 2 },
  { x: 3, y: 2 },
  { x: 4, y: 2 },
  { x: 1, y: 3 },
  { x: 2, y: 3 },
];

export const trainDescriptor = {
  startWagonId: 'car-a',
  wagons: [
    {
      id: 'car-a',
      title: 'Вагон А — Отсек пассажиров',
      floor: createFloorWithCar('train-car-main'),
      walls: [],
      decals: [],
      navmesh: baseNavmesh,
      spawn: { x: 1, y: 2 },
      doors: [
        {
          id: 'car-a-right',
          label: 'Перейти в тёмный вагон',
          position: { x: 4, y: 1 },
          radius: 48,
          targetWagonId: 'car-b',
          spawnPoint: { x: 0, y: 1 },
          lockedByFlag: 'doorAUnlocked',
          sprite: { id: 'door-indicator', offset: { x: -32, y: 16 } },
        },
        {
          id: 'car-a-left',
          label: 'Закрытая дверь назад',
          position: { x: -1, y: 1 },
          radius: 48,
          targetWagonId: 'car-a',
          spawnPoint: { x: 0, y: 1 },
          blockedIfFlag: 'brokenBackDoor',
          sprite: { id: 'door-indicator', offset: { x: 48, y: 16 }, scale: 0.9 },
        },
      ],
      npcs: [
        {
          id: 'conductor',
          name: 'Дежурный',
          position: { x: 1, y: 1 },
          radius: 40,
          dialogueId: 'conductor',
          idleAnimation: 'loop',
          sprite: { id: 'npc-conductor' },
        },
      ],
      objects: [
        {
          id: 'luggage',
          label: 'Багажная полка',
          position: { x: 2, y: 0 },
          radius: 40,
          onUse: 'luggage-check',
          sprite: { id: 'object-luggage', offset: { x: 0, y: -32 } },
        },
        {
          id: 'bench',
          label: 'Пустое кресло',
          position: { x: 0, y: 2 },
          radius: 36,
          onUse: 'bench-search',
          sprite: { id: 'object-seat', offset: { x: 0, y: 8 } },
        },
      ],
      hints: [
        { position: { x: 3.6, y: 1.2 }, message: 'Дверь ведёт дальше' },
      ],
      lights: [
        { id: 'a-main', center: { x: 1.5, y: 1.5 }, radius: 1.4, intensity: 0.45, flicker: true },
      ],
      ambient: 'normal',
    },
    {
      id: 'car-b',
      title: 'Вагон B — Технический отсек',
      floor: createFloorWithCar('train-car-dark'),
      walls: [],
      decals: [],
      navmesh: baseNavmesh,
      spawn: { x: 0, y: 1 },
      doors: [
        {
          id: 'car-b-left',
          label: 'Назад в салон',
          position: { x: 0, y: 1 },
          radius: 44,
          targetWagonId: 'car-a',
          spawnPoint: { x: 3, y: 1 },
          openByDefault: true,
          sprite: { id: 'door-indicator', offset: { x: 0, y: 16 }, scale: 0.9 },
        },
        {
          id: 'car-b-right',
          label: 'К кабине машиниста',
          position: { x: 4, y: 1 },
          radius: 48,
          targetWagonId: 'car-c',
          spawnPoint: { x: 0, y: 1 },
          lockedByFlag: 'powerRestored',
          sprite: { id: 'door-indicator', offset: { x: -32, y: 16 } },
        },
      ],
      npcs: [
        {
          id: 'mechanic-echo',
          name: 'Эхо механика',
          position: { x: 2, y: 2 },
          radius: 36,
          dialogueId: 'mechanic',
          idleAnimation: 'static',
          sprite: { id: 'npc-mechanic' },
        },
      ],
      objects: [
        {
          id: 'fuse-crate',
          label: 'Ящик с запчастями',
          position: { x: 3, y: 0 },
          radius: 40,
          onUse: 'crate-fuse',
          sprite: { id: 'object-luggage', offset: { x: 0, y: -28 } },
        },
        {
          id: 'power-panel',
          label: 'Электрощиток',
          position: { x: 1, y: 1 },
          radius: 44,
          onUse: 'panel-power',
          sprite: { id: 'object-panel', offset: { x: -12, y: -16 } },
        },
      ],
      hints: [
        { position: { x: 1, y: 1 }, message: 'Щиток без питания' },
      ],
      lights: [
        { id: 'b-lamp', center: { x: 1.5, y: 1.5 }, radius: 1.1, intensity: 0.35, flicker: true },
      ],
      ambient: 'dark',
    },
    {
      id: 'car-c',
      title: 'Кабина машиниста',
      floor: createFloorWithCar('train-car-light'),
      walls: [],
      decals: [],
      navmesh: [
        { x: 0, y: 0 },
        { x: 1, y: 0 },
        { x: 2, y: 0 },
        { x: 3, y: 0 },
        { x: 0, y: 1 },
        { x: 1, y: 1 },
        { x: 2, y: 1 },
        { x: 3, y: 1 },
        { x: 0, y: 2 },
        { x: 1, y: 2 },
      ],
      spawn: { x: 0, y: 1 },
      doors: [
        {
          id: 'car-c-left',
          label: 'Назад в техотсек',
          position: { x: 0, y: 1 },
          radius: 44,
          targetWagonId: 'car-b',
          spawnPoint: { x: 3, y: 1 },
          openByDefault: true,
          sprite: { id: 'door-indicator', offset: { x: 0, y: 16 }, scale: 0.9 },
        },
      ],
      npcs: [
        {
          id: 'engineer',
          name: 'Машинист',
          position: { x: 2, y: 1 },
          radius: 40,
          dialogueId: 'engineer',
          idleAnimation: 'loop',
          sprite: { id: 'npc-engineer' },
        },
      ],
      objects: [
        {
          id: 'console',
          label: 'Пульт управления',
          position: { x: 1, y: 0 },
          radius: 36,
          onUse: 'console-scan',
          sprite: { id: 'object-console', offset: { x: -12, y: -20 } },
        },
      ],
      hints: [
        { position: { x: 2, y: 1 }, message: 'Поговорить с машинистом' },
      ],
      lights: [
        { id: 'c-lamp', center: { x: 1.5, y: 0.8 }, radius: 1.1, intensity: 0.4, flicker: false },
      ],
      ambient: 'normal',
    },
  ],
};
